<html>
<head>
<title>LSBImageStego.java</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #000080; font-weight: bold;}
.s1 { color: #000000;}
.s2 { color: #808080; font-style: italic;}
.s3 { color: #808080; font-weight: bold; font-style: italic;}
.s4 { color: #0000ff;}
.s5 { color: #008000; font-weight: bold;}
.ln { color: #999999; font-weight: normal; font-style: normal; }
</style>
</head>
<body bgcolor="#ffffff">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#c0c0c0" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
LSBImageStego.java</font>
</center></td></tr></table>
<pre><a name="l1"><span class="ln">1    </span></a><span class="s0">package </span>com.example.imagesteganography;


<span class="s0">import </span>android.graphics.Bitmap;
<span class="s0">import </span>android.graphics.Canvas;
<span class="s0">import </span>android.graphics.Color;
<span class="s0">import </span>android.graphics.Paint;
<span class="s0">import </span>android.util.Log;

<span class="s0">import </span>java.util.Collections;

<span class="s0">public class </span>LSBImageStego {

    <span class="s0">private </span>Bitmap coverImage;
    <span class="s0">private </span>String secretMessage;
    <span class="s0">private </span>String Binary_OF_SecretMessage;
    <span class="s0">private int </span>originalSecretMessageLength;
    <span class="s0">private int </span>coverImage_rows;
    <span class="s0">private int </span>coverImage_columns;


    <span class="s2">/**</span>
     *
     * <span class="s3">@param </span><span class="s2">coverImage Bitmap Image obtained by the Uri generated by the User Selection</span>
     * <span class="s3">@param </span><span class="s2">secretMessage Secret Message,which the User wants to Encode into the Image</span>
     * <span class="s3">@description </span><span class="s2">This Constructor should be called for Encoding</span>
     */
    <span class="s0">public </span>LSBImageStego(Bitmap coverImage , String secretMessage){
        <span class="s0">this</span>.coverImage = coverImage.copy(Bitmap.Config.ARGB_8888 , <span class="s0">true</span>);
        <span class="s0">this</span>.coverImage_rows = <span class="s0">this</span>.coverImage.getHeight();
        <span class="s0">this</span>.coverImage_columns =  <span class="s0">this</span>.coverImage.getWidth();
        <span class="s0">this</span>.secretMessage = secretMessage;
        <span class="s0">this</span>.originalSecretMessageLength = <span class="s0">this</span>.secretMessage.length();
        <span class="s0">this</span>.makeBinaryStringFromMessage();
<span class="s2">//        Log.i(&quot;URI&quot; ,new Integer(this.coverImage_rows).toString());</span>
//        Log.i(&quot;URI&quot; , new Integer(this.coverImage_columns).toString());
//        Log.i(&quot;URI&quot; , this.secretMessage);
//        Log.i(&quot;URI&quot;, new Integer(this.originalSecretMessageLength).toString());
    }

    <span class="s2">/**</span>
     *
     * <span class="s3">@return</span>
     <span class="s2">* </span><span class="s3">@description </span><span class="s2">getter</span>
     */
    <span class="s0">public </span>Bitmap getCoverImage(){
        <span class="s0">return this</span>.coverImage;
    }

    <span class="s2">/**</span>
     *
     * <span class="s3">@return</span>
     <span class="s2">* </span><span class="s3">@description </span><span class="s2">getter</span>
     */
    <span class="s0">public </span>String getSecretMessage(){
        <span class="s0">return this</span>.secretMessage;
    }

    <span class="s2">/**</span>
     *
     * <span class="s3">@param </span><span class="s2">coverImage  Bitmap Image obtained by the Uri generated by the User Selection</span>
     * <span class="s3">@description </span><span class="s2">This Constructor should be called for Decoding</span>
     */
    <span class="s0">public </span>LSBImageStego(Bitmap coverImage){
        <span class="s0">this</span>.coverImage = coverImage.copy(Bitmap.Config.ARGB_8888 , <span class="s0">true</span>);
        <span class="s0">this</span>.coverImage_rows = <span class="s0">this</span>.coverImage.getHeight();
        <span class="s0">this</span>.coverImage_columns =  <span class="s0">this</span>.coverImage.getWidth();
    }

    <span class="s2">/**</span>
     * <span class="s3">@description </span><span class="s2">This method should be called for Decoding the Message from the Image</span>
     */
    <span class="s0">public void </span>decode(){
        <span class="s0">this</span>.getOriginalSecretMessageLength_FROM_Image();
        <span class="s0">this</span>.decodeMessageBinaryFromImage();
    }

    <span class="s2">/**</span>
     * <span class="s3">@description </span><span class="s2">This strips the Binary of the Secret Message from the Image,processes it and</span>
     *              passes it to decodeMsgFromBinary()
     */
    <span class="s0">private void </span>decodeMessageBinaryFromImage(){
        <span class="s0">int </span>retrieved = <span class="s4">0</span>;
        StringBuilder sb = <span class="s0">new </span>StringBuilder();
        <span class="s0">for</span>(<span class="s0">int </span>row = <span class="s4">0 </span>; row &lt;= (<span class="s0">this</span>.coverImage_rows - <span class="s4">1</span>) -<span class="s4">1 </span>; row++){
            <span class="s0">for</span>(<span class="s0">int </span>col = <span class="s4">0 </span>; col&lt;= (<span class="s0">this</span>.coverImage_columns -<span class="s4">1</span>) ; col++){
                <span class="s0">if</span>(retrieved == <span class="s0">this</span>.originalSecretMessageLength*<span class="s4">8</span>){
                    <span class="s0">this</span>.secretMessage = <span class="s0">this</span>.decodeMsgFromBinary(sb.toString());
                    Log.i(<span class="s5">&quot;URI&quot;</span>,<span class="s5">&quot;FOund MSG:&quot;</span>+<span class="s0">this</span>.secretMessage);
                    <span class="s0">return</span>;
                }
                <span class="s2">//                get current RED Pixel Intensity</span>
                <span class="s0">int </span>red = Color.red(<span class="s0">this</span>.coverImage.getPixel(col , row));

                <span class="s2">//              GETTING ORIGINAL Binary of RED Channel</span>
                String original = return8BinaryOfAscii(red);
                Log.i(<span class="s5">&quot;URI&quot; </span>, <span class="s5">&quot;Original(&quot;</span>+col+<span class="s5">&quot;,&quot;</span>+row+<span class="s5">&quot;) =&gt;&quot;</span>+original);

                String newLSBBits = original.substring(original.length()-<span class="s4">2 </span>, original.length());

                StringBuilder flip = <span class="s0">new </span>StringBuilder();
                <span class="s0">if</span>(newLSBBits.charAt(<span class="s4">0</span>)==<span class="s5">'0'</span>){
                    flip.append(<span class="s5">&quot;1&quot;</span>);
                }<span class="s0">else</span>{
                    flip.append(<span class="s5">&quot;0&quot;</span>);
                }

                <span class="s0">if</span>(newLSBBits.charAt(<span class="s4">1</span>)==<span class="s5">'0'</span>){
                    flip.append(<span class="s5">&quot;1&quot;</span>);
                }<span class="s0">else</span>{
                    flip.append(<span class="s5">&quot;0&quot;</span>);
                }

                newLSBBits = flip.toString();

                sb.append(newLSBBits);
                retrieved += <span class="s4">2</span>;
            }
        }
    }

    <span class="s2">/**</span>
     *
     * <span class="s3">@param </span><span class="s2">binary  Binary form of the Secret Message</span>
     * <span class="s3">@return </span><span class="s2">Returns the Secret Message corresponding to the given Binary</span>
     */
    <span class="s0">private </span>String decodeMsgFromBinary(String binary){
        StringBuilder sb = <span class="s0">new </span>StringBuilder();
        <span class="s0">for</span>(<span class="s0">int </span>i=<span class="s4">0 </span>; i&lt;= (binary.length() -<span class="s4">8</span>) ; i+=<span class="s4">8 </span>){
            String charBinary = binary.substring(i , i+<span class="s4">8</span>);
            sb.append(<span class="s0">new </span>Character( (<span class="s0">char</span>) Integer.parseInt(charBinary , <span class="s4">2</span>) ).toString());
        }

        <span class="s0">return </span>sb.toString();
    }

    <span class="s2">/**</span>
     *<span class="s3">@description </span><span class="s2">This method should be called for Encoding the Message into the Image</span>
     *              Before Encoding,we should Check whether the message can be Encoded or not
     *              by calling checkEncodability()
     */
    <span class="s0">public void </span>encode(){
        <span class="s0">this</span>.encodeMessage();
        <span class="s0">this</span>.encodeMessageLength();
    }

    <span class="s2">/**</span>
     * <span class="s3">@description </span><span class="s2">This retrieves the length of the Encoded Secret Message from the Encoded Image</span>
     */
    <span class="s0">private void </span>getOriginalSecretMessageLength_FROM_Image(){
        StringBuilder sb = <span class="s0">new </span>StringBuilder();
        <span class="s0">for</span>(<span class="s0">int </span>col = <span class="s4">0</span>; col&lt;= <span class="s0">this</span>.coverImage_columns-<span class="s4">1 </span>; col++){
            <span class="s2">//                get current Pixel Intensities</span>
            <span class="s0">int </span>alpha = Color.alpha(<span class="s0">this</span>.coverImage.getPixel(col , <span class="s0">this</span>.coverImage_rows -<span class="s4">1</span>));
            <span class="s0">int </span>red = Color.red(<span class="s0">this</span>.coverImage.getPixel(col , <span class="s0">this</span>.coverImage_rows -<span class="s4">1</span>));
            <span class="s0">int </span>green = Color.green(<span class="s0">this</span>.coverImage.getPixel(col , <span class="s0">this</span>.coverImage_rows -<span class="s4">1</span>));
            <span class="s0">int </span>blue = Color.blue(<span class="s0">this</span>.coverImage.getPixel(col , <span class="s0">this</span>.coverImage_rows -<span class="s4">1</span>));

            <span class="s2">//              GETTING ORIGINAL Binary of RED Channel</span>
            String original = return8BinaryOfAscii(red);

            sb.append(original.substring(original.length()-<span class="s4">2 </span>, original.length()));
        }
        Log.i(<span class="s5">&quot;URI&quot; </span>, <span class="s5">&quot;LENGHT FOUND:&quot; </span>+ Integer.parseInt(sb.toString() , <span class="s4">2</span>));
        <span class="s0">this</span>.originalSecretMessageLength = Integer.parseInt(sb.toString() , <span class="s4">2</span>);
    }

    <span class="s2">/**</span>
     * <span class="s3">@description </span><span class="s2">This encodes the Length of the Secret Message in the last row of the Image.</span>
     */
    <span class="s0">private void </span>encodeMessageLength(){
        String originalBinary_OF_MsgLength = Integer.toBinaryString(<span class="s0">this</span>.originalSecretMessageLength);
        String encodableBinary = <span class="s0">this</span>.getEncodableBinaryOfMsgLengthBinary(originalBinary_OF_MsgLength);
        <span class="s0">int </span>count = <span class="s4">0</span>;
        <span class="s0">int </span>remaining = encodableBinary.length();
        <span class="s0">for</span>(<span class="s0">int </span>col = <span class="s4">0 </span>; col &lt;= <span class="s0">this</span>.coverImage_columns -<span class="s4">1 </span>; col++){
            <span class="s0">if</span>(count &gt; remaining - <span class="s4">2</span>){
                <span class="s0">return</span>;
            }

            <span class="s2">//                get current Pixel Intensities</span>
            <span class="s0">int </span>alpha = Color.alpha(<span class="s0">this</span>.coverImage.getPixel(col , <span class="s0">this</span>.coverImage_rows -<span class="s4">1</span>));
            <span class="s0">int </span>red = Color.red(<span class="s0">this</span>.coverImage.getPixel(col , <span class="s0">this</span>.coverImage_rows -<span class="s4">1</span>));
            <span class="s0">int </span>green = Color.green(<span class="s0">this</span>.coverImage.getPixel(col , <span class="s0">this</span>.coverImage_rows -<span class="s4">1</span>));
            <span class="s0">int </span>blue = Color.blue(<span class="s0">this</span>.coverImage.getPixel(col , <span class="s0">this</span>.coverImage_rows -<span class="s4">1</span>));

            <span class="s2">//              GETTING ORIGINAL Binary of RED Channel</span>
            String original = return8BinaryOfAscii(red);
            Log.i(<span class="s5">&quot;URI&quot; </span>, <span class="s5">&quot;Original(&quot;</span>+col+<span class="s5">&quot;,&quot;</span>+(<span class="s0">this</span>.coverImage_rows -<span class="s4">1</span>)+<span class="s5">&quot;) =&gt;&quot;</span>+original);

            <span class="s2">//                Get Modified String by Changing LSB 2 Bits</span>
            String newLSBBits = encodableBinary.substring(count , count +<span class="s4">2</span>);
            count += <span class="s4">2</span>;

            Log.i(<span class="s5">&quot;URI&quot; </span>, <span class="s5">&quot;New LSBs(&quot;</span>+col+<span class="s5">&quot;,&quot;</span>+(<span class="s0">this</span>.coverImage_rows -<span class="s4">1</span>)+<span class="s5">&quot;) =&gt;&quot;</span>+newLSBBits);


            String modified = original.substring(<span class="s4">0 </span>, original.length() - <span class="s4">2</span>) + newLSBBits;

            Log.i(<span class="s5">&quot;URI&quot; </span>, <span class="s5">&quot;Modified(&quot;</span>+col+<span class="s5">&quot;,&quot;</span>+(<span class="s0">this</span>.coverImage_rows -<span class="s4">1</span>)+<span class="s5">&quot;) =&gt;&quot;</span>+modified);

            <span class="s0">int </span>modifiedRed = Integer.valueOf(modified , <span class="s4">2</span>);


<span class="s2">//                Writing Pixel Back</span>
            <span class="s0">this</span>.coverImage.setHasAlpha(<span class="s0">false</span>);
            <span class="s0">this</span>.coverImage.setPixel(col , <span class="s0">this</span>.coverImage_rows -<span class="s4">1 </span>, Color.argb(alpha , modifiedRed , green , blue));

        }
    }

    <span class="s2">/**</span>
     *
     * <span class="s3">@param </span><span class="s2">originalBinary  The Binary of the Length_OF_Secret_Message</span>
     * <span class="s3">@return  </span><span class="s2">Returns the Binary String,which can be used to encode directly</span>
     */
    <span class="s0">private </span>String getEncodableBinaryOfMsgLengthBinary(String originalBinary){
        <span class="s0">return </span>String.join(<span class="s5">&quot;&quot; </span>, Collections.nCopies(
                (<span class="s0">this</span>.coverImage_columns * <span class="s4">2 </span>- (originalBinary.length())), <span class="s5">&quot;0&quot;</span>)) + originalBinary;
    }

    <span class="s2">/**</span>
     * <span class="s3">@description </span><span class="s2">This method encodes the Secret message into the image</span>
     */
    <span class="s0">private void </span>encodeMessage(){
        <span class="s0">int </span>count = <span class="s4">0</span>;
        <span class="s0">int </span>remaining = <span class="s0">this</span>.Binary_OF_SecretMessage.length();
        <span class="s0">for</span>(<span class="s0">int </span>row = <span class="s4">0 </span>; row &lt;= (<span class="s0">this</span>.coverImage_rows - <span class="s4">1</span>) -<span class="s4">1 </span>; row++){
            <span class="s0">for</span>(<span class="s0">int </span>col = <span class="s4">0 </span>; col&lt;= (<span class="s0">this</span>.coverImage_columns -<span class="s4">1</span>) ; col++){

                <span class="s0">if</span>(count &gt; remaining - <span class="s4">2</span>){
                    <span class="s0">return</span>;
                }

                <span class="s2">//                get current Pixel Intensities</span>
                <span class="s0">int </span>alpha = Color.alpha(<span class="s0">this</span>.coverImage.getPixel(col , row));
                <span class="s0">int </span>red = Color.red(<span class="s0">this</span>.coverImage.getPixel(col , row));
                <span class="s0">int </span>green = Color.green(<span class="s0">this</span>.coverImage.getPixel(col , row));
                <span class="s0">int </span>blue = Color.blue(<span class="s0">this</span>.coverImage.getPixel(col , row));

<span class="s2">//              GETTING ORIGINAL Binary of RED Channel</span>
                String original = return8BinaryOfAscii(red);
                Log.i(<span class="s5">&quot;URI&quot; </span>, <span class="s5">&quot;Original(&quot;</span>+col+<span class="s5">&quot;,&quot;</span>+row+<span class="s5">&quot;) =&gt;&quot;</span>+original);

<span class="s2">//                Get Modified String by Changing LSB 2 Bits</span>
                String newLSBBits = <span class="s0">this</span>.Binary_OF_SecretMessage.substring(count , count +<span class="s4">2</span>);
                count += <span class="s4">2</span>;

                StringBuilder flip = <span class="s0">new </span>StringBuilder();
                <span class="s0">if</span>(newLSBBits.charAt(<span class="s4">0</span>)==<span class="s5">'0'</span>){
                    flip.append(<span class="s5">&quot;1&quot;</span>);
                }<span class="s0">else</span>{
                    flip.append(<span class="s5">&quot;0&quot;</span>);
                }

                <span class="s0">if</span>(newLSBBits.charAt(<span class="s4">1</span>)==<span class="s5">'0'</span>){
                    flip.append(<span class="s5">&quot;1&quot;</span>);
                }<span class="s0">else</span>{
                    flip.append(<span class="s5">&quot;0&quot;</span>);
                }

                newLSBBits = flip.toString();

                Log.i(<span class="s5">&quot;URI&quot; </span>, <span class="s5">&quot;New LSBs(&quot;</span>+col+<span class="s5">&quot;,&quot;</span>+row+<span class="s5">&quot;) =&gt;&quot;</span>+newLSBBits);


                String modified = original.substring(<span class="s4">0 </span>, original.length() - <span class="s4">2</span>) + newLSBBits;

                Log.i(<span class="s5">&quot;URI&quot; </span>, <span class="s5">&quot;Modified(&quot;</span>+col+<span class="s5">&quot;,&quot;</span>+row+<span class="s5">&quot;) =&gt;&quot;</span>+modified);

                <span class="s0">int </span>modifiedRed = Integer.valueOf(modified , <span class="s4">2</span>);

<span class="s2">//                Writing Pixel Back</span>
                <span class="s0">this</span>.coverImage.setHasAlpha(<span class="s0">false</span>);
                <span class="s0">this</span>.coverImage.setPixel(col , row , Color.argb(alpha , modifiedRed , green , blue));
            }
        }
    }

    <span class="s2">/**</span>
     *
     * <span class="s3">@return </span><span class="s2">Returns true,if the given secret message can be encoded into the given Image.If</span>
     *          not,it returns false.
     */
    <span class="s0">public boolean </span>checkEncodability(){
        <span class="s0">return this</span>.Binary_OF_SecretMessage.length() &lt;= ((<span class="s0">this</span>.coverImage_rows - <span class="s4">1</span>)*<span class="s0">this</span>.coverImage_columns*<span class="s4">2 </span>) ;
    }

    <span class="s2">/**</span>
     * <span class="s3">@description </span><span class="s2">This makes Binary String corresponding to the Secret Message</span>
     */
    <span class="s0">private void </span>makeBinaryStringFromMessage(){
        StringBuilder sb = <span class="s0">new </span>StringBuilder();
        <span class="s0">for</span>(<span class="s0">int </span>i=<span class="s4">0</span>; i&lt;= <span class="s0">this</span>.originalSecretMessageLength-<span class="s4">1 </span>; i++){
            <span class="s0">int </span>ascii = (<span class="s0">int</span>) <span class="s0">this</span>.secretMessage.charAt(i);
            sb.append(<span class="s0">this</span>.return8BinaryOfAscii(ascii));
        }
        <span class="s0">this</span>.Binary_OF_SecretMessage = sb.toString();
        Log.i(<span class="s5">&quot;URI&quot; </span>,<span class="s5">&quot;BINARY MESSAGE:&quot;</span>+ <span class="s0">this</span>.Binary_OF_SecretMessage);
    }

    <span class="s2">/**</span>
     *
     * <span class="s3">@param </span><span class="s2">ascii ascii or Unicode of a character</span>
     * <span class="s3">@return </span><span class="s2">Returns corresponding 8-bit Binary corresponding to the ascii or unicode</span>
     */
    <span class="s0">private </span>String return8BinaryOfAscii(<span class="s0">int </span>ascii){
        String binary = Integer.toBinaryString(ascii);
        <span class="s0">return </span>String.join(<span class="s5">&quot;&quot; </span>, Collections.nCopies(<span class="s4">8</span>-(binary.length()) , <span class="s5">&quot;0&quot;</span>)) + binary;
    }
}
</pre>
</body>
</html>